<!DOCTYPE 5><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>500 Primes | Soharu's Notes</title><meta name="generator" content="DocPad v6.79.4" /><link  rel="stylesheet" href="/styles/style.css" /><link  rel="stylesheet" href="/styles/darcula.css" /></head><body><header><section><h1><a href="https://soharu.github.io">Soharu's Notes</a></h1><p>읽고, 쓰고, 그리고, 코딩하는 하루</p></section></header><nav><ul><li class="inactive"><a href="/about.html">About Me</a></li><li class="inactive"><a href="/posts.html">Posts</a></li><li class="inactive"><a href="/tags.html">Tags</a></li></ul></nav><section class="post"><article><h2><a href="/posts/2014-03-24-commented-500-primes.html">500 Primes</a></h2><date>2014/03/24 월</date><h3 id="source-code">Source Code</h3>
<pre class="highlight"><code class="hljs armasm">% Algorithm P: Print table of <span class="hljs-number">500</span> primes
L       IS      <span class="hljs-number">500</span>                 % The number of primes to find
t       IS      <span class="hljs-number">$255</span>                % Temporary storage
n       GREG    <span class="hljs-number">0</span>                   % Prime candidate
q       GREG    <span class="hljs-number">0</span>                   % Quotient
r       GREG    <span class="hljs-number">0</span>                   % Remainder
<span class="hljs-symbol">jj</span>      GREG    <span class="hljs-number">0</span>                   % Index for PRIME[j]
<span class="hljs-symbol">kk</span>      GREG    <span class="hljs-number">0</span>                   % Index for PRIME[k]
<span class="hljs-symbol">pk</span>      GREG    <span class="hljs-number">0</span>                   % Value of PRIME[k]
<span class="hljs-symbol">mm</span>      IS      kk                  % Index for output lines
        LOC     Data_Segment
<span class="hljs-symbol">PRIME1</span>  WYDE    <span class="hljs-number">2</span>                   % PRIME[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>
        LOC     PRIME1+<span class="hljs-number">2</span>*L
<span class="hljs-symbol">ptop</span>    GREG    <span class="hljs-comment">@                   % Address of PRIME[501]</span>
<span class="hljs-symbol">j0</span>      GREG    PRIME1+<span class="hljs-number">2</span>-<span class="hljs-comment">@          % Initial value of jj</span>
<span class="hljs-keyword">BUF </span>    OCTA    <span class="hljs-number">0</span>                   % Place to form decimal <span class="hljs-keyword">string
</span>
        LOC     <span class="hljs-number">#100</span>
<span class="hljs-symbol">Main</span>    SET     n,<span class="hljs-number">3</span>                 % <span class="hljs-built_in">P1</span>. Start table. n &lt;- <span class="hljs-number">3</span>
        SET     jj,j0               % j &lt;- <span class="hljs-number">1</span>
<span class="hljs-number">2</span>H      STWU    n,ptop,jj           % <span class="hljs-built_in">P2</span>. n is prime. PRIME[j+<span class="hljs-number">1</span>] &lt;- n
        INCL    jj,<span class="hljs-number">2</span>                % j &lt;- j + <span class="hljs-number">1</span>
<span class="hljs-number">3</span>H      <span class="hljs-keyword">BZ </span>     jj,<span class="hljs-number">2</span>F               % <span class="hljs-built_in">P3</span>. <span class="hljs-number">500</span> found?
<span class="hljs-number">4</span>H      INCL    n,<span class="hljs-number">2</span>                 % <span class="hljs-built_in">P4</span>. Advance n
<span class="hljs-number">5</span>H      SET     kk,j0               % <span class="hljs-built_in">P5</span>. k &lt;- <span class="hljs-number">2</span> / k = ptop - kk
<span class="hljs-number">6</span>H      LDWU    pk,ptop,kk          % <span class="hljs-built_in">P6</span>. n / PRIME[k] ?
        DIV     q,n,pk              % q &lt;- floor(n / PRIME[k])
        <span class="hljs-meta">GET</span>     r,rR                % r &lt;- n mod PRIME[k]
        <span class="hljs-keyword">BZ </span>     r,<span class="hljs-number">4</span>B                % To <span class="hljs-built_in">P4</span> <span class="hljs-meta">if</span> r = <span class="hljs-number">0</span> for checking the next n
<span class="hljs-number">7</span>H      <span class="hljs-keyword">CMP </span>    t,q,pk              % <span class="hljs-built_in">P7</span>. PRIME[k] large?
        <span class="hljs-keyword">BNP </span>    t,<span class="hljs-number">2</span>B                % To <span class="hljs-built_in">P4</span> <span class="hljs-meta">if</span> q &lt;= PRIME[k]
<span class="hljs-number">8</span>H      INCL    kk,<span class="hljs-number">2</span>                % <span class="hljs-built_in">P8</span>. Advance k. k &lt;- k + <span class="hljs-number">1</span>
        JMP     <span class="hljs-number">6</span>B                  % To <span class="hljs-built_in">P6</span>.
        GREG    <span class="hljs-comment">@                   % Base address</span>
<span class="hljs-symbol">Title</span>   <span class="hljs-keyword">BYTE </span>   <span class="hljs-string">"First Five Hundred Primes"</span>
<span class="hljs-symbol">NewLn</span>   <span class="hljs-keyword">BYTE </span>   <span class="hljs-symbol">#a</span>,<span class="hljs-number">0</span>
<span class="hljs-keyword">Blanks </span> <span class="hljs-keyword">BYTE </span>   <span class="hljs-string">"   "</span>,<span class="hljs-number">0</span>             % <span class="hljs-keyword">String </span>of three <span class="hljs-keyword">blanks
</span><span class="hljs-number">2</span>H      LDA     t,Title             % <span class="hljs-built_in">P9</span>. Print Title
        TRAP    <span class="hljs-number">0</span>,Fputs,StdOut
        NEG     mm,<span class="hljs-number">2</span>
<span class="hljs-number">3</span>H      <span class="hljs-keyword">ADD </span>    mm,mm,j0            % <span class="hljs-built_in">P10</span>. Print line
        LDA     t,<span class="hljs-keyword">Blanks </span>           % Output <span class="hljs-string">"   "</span>.
        TRAP    <span class="hljs-number">0</span>,Fputs,StdOut
<span class="hljs-number">2</span>H      LDWU    pk,ptop,mm          % pk &lt;- prime to <span class="hljs-keyword">be </span>printed
<span class="hljs-number">0</span>H      GREG    <span class="hljs-number">#2030303030000000</span>   % <span class="hljs-string">" 0000"</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
        STOU    <span class="hljs-number">0</span>B,<span class="hljs-keyword">BUF </span>             % Prepare <span class="hljs-keyword">buffer </span>for decimal conversion
        LDA     t,<span class="hljs-keyword">BUF+4 </span>            % t &lt;- position of units digit
<span class="hljs-number">1</span>H      DIV     pk,pk,<span class="hljs-number">10</span>            % pk &lt;- floor(pk/<span class="hljs-number">10</span>)
        <span class="hljs-meta">GET</span>     r,rR                % r &lt;- next digit
        INCL    r,<span class="hljs-string">'0'</span>               % r &lt;- ASCII digit r
        STBU    r,t,<span class="hljs-number">0</span>               % Store r in the <span class="hljs-keyword">buffer
</span>        <span class="hljs-keyword">SUB </span>    t,t,<span class="hljs-number">1</span>               % <span class="hljs-keyword">Move </span>one <span class="hljs-keyword">byte </span>to the left
        PBNZ    pk,<span class="hljs-number">1</span>B               % Repeat on remaining digits
        LDA     t,<span class="hljs-keyword">BUF </span>              % Output <span class="hljs-string">" "</span> <span class="hljs-keyword">and </span>four digits
        TRAP    <span class="hljs-number">0</span>,Fputs,StdOut
        INCL    mm,<span class="hljs-number">2</span>*L/<span class="hljs-number">10</span>           % Advance <span class="hljs-keyword">by </span><span class="hljs-number">50</span> wydes
        PBN     mm,<span class="hljs-number">2</span>B
        LDA     t,NewLn             % Output a newline
        TRAP    <span class="hljs-number">0</span>,Fputs,StdOut
        <span class="hljs-keyword">CMP </span>    t,mm,<span class="hljs-number">2</span>*(L/<span class="hljs-number">10</span>-<span class="hljs-number">1</span>)     % <span class="hljs-built_in">P11</span>. <span class="hljs-number">500</span> printed?
        PBNZ    t,<span class="hljs-number">3</span>B                % To <span class="hljs-built_in">P10</span> <span class="hljs-meta">if</span> not done
        TRAP    <span class="hljs-number">0</span>,Halt,<span class="hljs-number">0</span>
</code></pre>
<h3 id="-">시작에 앞서...</h3>
<p>코드의 각 필드는 다음을 의미한다.</p>
<table>
<thead>
<tr>
<th style="text-align:left">line number</th>
<th style="text-align:left">LABEL</th>
<th style="text-align:left">OP</th>
<th style="text-align:left">EXPR</th>
<th style="text-align:left">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">02</td>
<td style="text-align:left">L</td>
<td style="text-align:left">IS</td>
<td style="text-align:left">500</td>
<td style="text-align:left">% The number of primes to find</td>
</tr>
</tbody>
</table>
<h4 id="line-01">Line 01</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">01 </span>% Algorithm P: <span class="hljs-keyword">Print</span> table of <span class="hljs-number">500</span> primes
</code></pre><p>%로 시작하는 01은 주석으로 어셈블리 코드에 영향을 주지 않는다.</p>
<h3 id="-">전역 레지스터 선언과 초기화</h3>
<h4 id="line-02-03">Line 02 ~ 03</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">02 </span>L       IS      <span class="hljs-number">500</span>             % The number of primes <span class="hljs-keyword">to</span> find
<span class="hljs-symbol">03 </span>t       IS      $<span class="hljs-number">255</span>            % Temporary storage
</code></pre><blockquote>
<p>..., the pseudo-operation <code>IS</code> sets the equivalent of a symbol.</p>
</blockquote>
<p>Pseudo-operation <code>IS</code>는 심볼의 값을 설정한다.</p>
<p>02에서 <code>L</code>은 500으로 설정된다. 이 값은 우리가 찾을 소수의 갯수이다.
03에서 <code>t</code>의 값은 $255 레지스터이다.</p>
<p>심볼들은 $0 ~ $255 범위의 레지스터 값을 갖거나, 8바이트의 숫자값을 가질 수 있다.</p>
<p>일반적으로 레지스터를 나타내는 심볼은 소문자로 시작하고, 순수한 값을 나태내는 심볼은 대문자를 사용한다.</p>
<h4 id="line-04-09">Line 04 ~ 09</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">04 </span>n       GREG    <span class="hljs-number">0</span>               % Prime candidate
<span class="hljs-symbol">05 </span>q       GREG    <span class="hljs-number">0</span>               % Quotient
<span class="hljs-symbol">06 </span>r       GREG    <span class="hljs-number">0</span>               % <span class="hljs-comment">Remainder</span>
<span class="hljs-symbol">07 </span>jj      GREG    <span class="hljs-number">0</span>               % Index <span class="hljs-keyword">for</span> PRIME[j]
<span class="hljs-symbol">08 </span>kk      GREG    <span class="hljs-number">0</span>               % Index <span class="hljs-keyword">for</span> PRIME[k]
<span class="hljs-symbol">09 </span>pk      GREG    <span class="hljs-number">0</span>               % Value of PRIME[k]
</code></pre><blockquote>
<p>The pseudo-op <code>GREG</code> on line 04 allocates a global register.</p>
</blockquote>
<p>Pseudo-operation <code>GREG</code>는 전역 레지스터를 할당한다.</p>
<p>$255 레지스터는 항상 전역 레지스터이다.</p>
<p>04의 <code>GREG</code>는 $254를 전역 레지스터로 만든다. 05도 마찬가지로 $253에 대해서 그러하다. 따라서 04에서 09까지 총 6개의 전역 레지스터가 할당된다. 그리고 n, q, r, jj, kk, pk는 각 레지스터와 동일하다.</p>
<table>
<thead>
<tr>
<th style="text-align:center">Symbol</th>
<th style="text-align:center">Global Register</th>
<th style="text-align:center">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">n</td>
<td style="text-align:center">$254</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">q</td>
<td style="text-align:center">$253</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">r</td>
<td style="text-align:center">$252</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">jj</td>
<td style="text-align:center">$251</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">kk</td>
<td style="text-align:center">$250</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">pk</td>
<td style="text-align:center">$249</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p><code>GREG</code> 정의의 EXPR 필드가  <strong>0</strong>이면, 해당 전역 레지스터는 프로그램이 실행될 때 동적으로 변하는 값을 갖는다고 가정한다.</p>
<p>14, 15, 34, 45와 같이 0이 아닌 식이 주어지면, 해당 전역 레지스터는 프로그램이 실행되는 동안 상수값을 갖는다.</p>
<h4 id="line-10">Line 10</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">10 </span>mm      IS      kk              % Index <span class="hljs-keyword">for</span> output lines
</code></pre><p>08줄에 따라 mm은 $250와 동일하다.</p>
<h4 id="line-11">Line 11</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">11 </span>        <span class="hljs-keyword">LOC</span>     Data_Segment
</code></pre><blockquote>
<p><code>Location LOC Expression</code> : Continue to assemble instructions or data at the position in memory given by Expression. Often used Expressions are: #100 (where programs start) or Data_Segment. -- MMIX Quick Reference Card &quot;Assembler Directives&quot;</p>
</blockquote>
<p>Pseudo-operation <code>LOC</code>는 <code>EXPR</code>에 의해 주어진 <strong>메모리의 위치</strong>에서 어셈블리 명령 또는 데이터가 계속됨을 의미한다.</p>
<p>Data_Segment는 MMIXAL에서 편의상 #2000 0000 0000 0000 (보기 편의상 4자리 마다 공백 문자를 넣었음. 실제로는 붙여써야 함)로 미리 정의되어 있다.</p>
<h4 id="line-12">Line 12</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">12 </span>PRIME1  WYDE    <span class="hljs-number">2</span>               % PRIME[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>
</code></pre><p><code>WYDE</code>는 2바이트 메모리를 할당하고 <code>EXPR</code>의 결과로 로 초기화 한다. 그리고 <code>LABEL</code>은 할당된 주소의 이름이 된다. 그리하야 <code>Data_Segment</code> 영역에 소수를 저장할 공간의 시작 주소에 <code>PRIME1</code> 이라는 이름이 붙었고, 거기에 첫번째 소수인 2가 저장되었다.</p>
<h4 id="line-13-line-15">Line 13 ~ Line 15</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">13 </span>        <span class="hljs-keyword">LOC</span>     PRIME1+<span class="hljs-number">2</span>*L
<span class="hljs-symbol">14 </span>ptop    GREG    @               % Address of PRIME[<span class="hljs-number">501</span>]
<span class="hljs-symbol">15 </span>j0      GREG    PRIME1+<span class="hljs-number">2</span>-@      % Initial value of jj
</code></pre><p>전역 레지스터 ptop에 PRIME1으로 부터 1000 bytes 떨어진 메모리의 주소를 저장한다.</p>
<p>그리고 전역 레지스터 ptop, j0에 아래와 같은 값이 초기화 된다.</p>
<table>
<thead>
<tr>
<th style="text-align:center">Symbol</th>
<th style="text-align:center">Global Register</th>
<th style="text-align:center">Value</th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ptop</td>
<td style="text-align:center">$248</td>
<td style="text-align:center">#20000000000003e8</td>
<td style="text-align:left">PRIME1+1000</td>
</tr>
<tr>
<td style="text-align:center">j0</td>
<td style="text-align:center">$247</td>
<td style="text-align:center">-998</td>
<td style="text-align:left">PRIME1+2-(PRIME1+1000)</td>
</tr>
</tbody>
</table>
<h4 id="line-16">Line 16</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">16 </span>BUF     OCTA    <span class="hljs-number">0</span>               % Place <span class="hljs-keyword">to</span> form decimal string
</code></pre><p>이 후 결과 출력을 위해 십진수 숫자를 저장할 문자열 버퍼로 메모리에 8 byte를 할당하고 0으로 초기화 한다. 그리고 그 주소의 이름은 <code>BUF</code>.</p>
<h3 id="-">소수 구하기</h3>
<h4 id="line-18">Line 18</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">18 </span>        <span class="hljs-keyword">LOC</span>     #<span class="hljs-number">100</span>
</code></pre><p>user space address #0000 0000 0000 0100에 아래 코드가 위치한다.</p>
<h4 id="line-19-20">Line 19 ~ 20</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">19 </span>Main    SET     n,<span class="hljs-number">3</span>             % P1. Start table. n &lt;- <span class="hljs-number">3</span>
<span class="hljs-symbol">20 </span>        SET     jj,j0           % j &lt;- <span class="hljs-number">1</span>
</code></pre><table>
<thead>
<tr>
<th style="text-align:center">Symbol</th>
<th style="text-align:center">Global Register</th>
<th style="text-align:center">Previous Value</th>
<th style="text-align:center">Current Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">n</td>
<td style="text-align:center">$254</td>
<td style="text-align:center">0</td>
<td style="text-align:center">3</td>
</tr>
<tr>
<td style="text-align:center">jj</td>
<td style="text-align:center">$251</td>
<td style="text-align:center">0</td>
<td style="text-align:center">-998</td>
</tr>
<tr>
<td style="text-align:center">j0</td>
<td style="text-align:center">$247</td>
<td style="text-align:center">-998</td>
<td style="text-align:center">-998</td>
</tr>
</tbody>
</table>
<h4 id="line-21-33">Line 21 ~ 33</h4>
<p>소수를 찾는 루프 부분.</p>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">21 </span><span class="hljs-number">2</span>H      STWU    n,ptop,jj       % P2. n is prime. PRIME[j+<span class="hljs-number">1</span>] &lt;- n
<span class="hljs-symbol">22 </span>        INCL    jj,<span class="hljs-number">2</span>            % j &lt;- j + <span class="hljs-number">1</span>
<span class="hljs-symbol">23 </span><span class="hljs-number">3</span>H      BZ      jj,<span class="hljs-number">2</span>F           % P3. <span class="hljs-number">500</span> found?
<span class="hljs-symbol">24 </span><span class="hljs-number">4</span>H      INCL    n,<span class="hljs-number">2</span>             % P4. Advance n
<span class="hljs-symbol">25 </span><span class="hljs-number">5</span>H      SET     kk,j0           % P5. k &lt;- <span class="hljs-number">2</span> / k = ptop + kk
<span class="hljs-symbol">26 </span><span class="hljs-number">6</span>H      LDWU    pk,ptop,kk      % P6. n / PRIME[k] ?
<span class="hljs-symbol">27 </span>        DIV     q,n,pk          %       q &lt;- floor(n / PRIME[k])
<span class="hljs-symbol">28 </span>        <span class="hljs-keyword">GET</span>     r,rR            %       r &lt;- n <span class="hljs-keyword">mod</span> PRIME[k]
<span class="hljs-symbol">29 </span>        BZ      r,<span class="hljs-number">4</span>B            % <span class="hljs-keyword">To</span> P4 <span class="hljs-keyword">if</span> r = <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> checking the <span class="hljs-keyword">next</span> n
<span class="hljs-symbol">30 </span><span class="hljs-number">7</span>H      CMP     t,q,pk          % P7. PRIME[k] large?
<span class="hljs-symbol">31 </span>        BNP     t,<span class="hljs-number">2</span>B            % <span class="hljs-keyword">To</span> P4 <span class="hljs-keyword">if</span> q &lt;= PRIME[k]
<span class="hljs-symbol">32 </span><span class="hljs-number">8</span>H      INCL    kk,<span class="hljs-number">2</span>            % P8. Advance k. k &lt;- k + <span class="hljs-number">1</span>
<span class="hljs-symbol">33 </span>        JMP     <span class="hljs-number">6</span>B              % <span class="hljs-keyword">To</span> P6.
</code></pre><p>21번 줄에서는 n = 3이고, 3이 소수이므로 n을 PRIME[ptop + jj]에 저장한다. 뒤의 31번 줄에서 소수를 찾았을 때 2H로 브랜치하여 n을 저장한다.</p>
<p>22번 줄에서는 jj를 2만큼 증가시켜 다음 소수가 저장될 위치에 대한 인덱스로 사용할 수 있게 한다.</p>
<p>23번 줄에서는 jj가 0이되면 500개의 소수가 모두 구해진 것으로 이 경우에는 &quot;2 Forward&quot;로 2H 라벨이 붙은 44줄로 이동한다.</p>
<p>24번 줄에서는 홀수만 검사하기 위해 n을 2씩 증가 시킨다.</p>
<p>25번 줄에서는 n이 현재까지 찾은 소수로 나눠지는지 검사하기 위해 나눠볼 소수에 대한 인덱스로 kk를 사용한다. k = ptop + kk. n은 홀수이므로 ptop에 있는 2로는 나눠볼 필요가 없기  때문에 kk를 j0로 설정한다.</p>
<p>26번 줄에서는 메모리에 있는 k번째 소수를 로드한다. pk = M[ptop + kk] 값이 설정된다.</p>
<p>27번 줄에서 n을 pk로 나눈 몫을 q에 저장한다.</p>
<p>28번 줄에서는 레지스터 r(g#252)로 rR(remainder register)의 값을 가져온다.</p>
<p>29번 줄에서는 r이 0인지 여부를 검사하는데, r이 0이라는 것은 n이 소수로 나눠진다는 것을 의미하므로 n은 소수가 아니다. 때문에 다음 소수를 검사하기 위해 &quot;4 backward&quot; 하여 24번 줄로 이동한다.</p>
<p>30번 줄에서는 q와 pk의 값을 비교하는데 만약 q &lt;= pk 이면 n은 소수이다. 이에 대한 증명은 연습문제 11번을 참고.</p>
<p>31번 줄에서는 q&lt;= pk인 경우 t &lt;= 0이 되므로 n은 소수로 판정되고 n을 저장하기 위해 &quot;2 backward&quot;인 21번 줄의 2H 라벨로 이동한다.</p>
<p>32번 줄에서는 n이 소수인지 아직 알 수 없으므로  다음 소수로 나눠보기 위해서 kk를 2만큼 증가시킨다.</p>
<p>33번 줄에서는 pk[ptop + kk]로 n을 나눠보기 위해서 &quot;6 backward&quot;인 26번 줄의 6H 라벨로 이동한다.</p>
<h3 id="-">테이블 출력</h3>
<p>결과가 출력되는 형식은 다음과 같다.</p>
<pre class="highlight"><code class="hljs lsl">First Five Hundred Primes
First Five Hundred Primes
    <span class="hljs-number">0002</span> <span class="hljs-number">0233</span> <span class="hljs-number">0547</span> <span class="hljs-number">0877</span> <span class="hljs-number">1229</span> <span class="hljs-number">1597</span> <span class="hljs-number">1993</span> <span class="hljs-number">2371</span> <span class="hljs-number">2749</span> <span class="hljs-number">3187</span>
    <span class="hljs-number">0003</span> <span class="hljs-number">0239</span> <span class="hljs-number">0557</span> <span class="hljs-number">0881</span> <span class="hljs-number">1231</span> <span class="hljs-number">1601</span> <span class="hljs-number">1997</span> <span class="hljs-number">2377</span> <span class="hljs-number">2753</span> <span class="hljs-number">3191</span>
    <span class="hljs-number">0005</span> <span class="hljs-number">0241</span> <span class="hljs-number">0563</span> <span class="hljs-number">0883</span> <span class="hljs-number">1237</span> <span class="hljs-number">1607</span> <span class="hljs-number">1999</span> <span class="hljs-number">2381</span> <span class="hljs-number">2767</span> <span class="hljs-number">3203</span>
    ...
    <span class="hljs-number">0229</span> <span class="hljs-number">0541</span> <span class="hljs-number">0863</span> <span class="hljs-number">1223</span> <span class="hljs-number">1583</span> <span class="hljs-number">1987</span> <span class="hljs-number">2357</span> <span class="hljs-number">2741</span> <span class="hljs-number">3181</span> <span class="hljs-number">3571</span>
</code></pre><h4 id="line-34-37">Line 34 ~ 37</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">34 </span>        GREG    @               % <span class="hljs-keyword">Base</span> address
<span class="hljs-symbol">35 </span>Title   BYTE    <span class="hljs-string">"First Five Hundred Primes"</span>
<span class="hljs-symbol">36 </span>NewLn   BYTE    #a,<span class="hljs-number">0</span>
<span class="hljs-symbol">37 </span>Blanks  BYTE    <span class="hljs-string">"   "</span>,<span class="hljs-number">0</span>         % String of three blanks
</code></pre><p>메모리에 출력에 필요한 문자열들을 위한 메모리를 할당하고 초기화한다.</p>
<h4 id="line-38-39">Line 38 ~ 39</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">38 </span><span class="hljs-number">2</span>H      LDA     t,Title         % P9. <span class="hljs-keyword">Print</span> Title
<span class="hljs-symbol">39 </span>        TRAP    <span class="hljs-number">0</span>,Fputs,StdOut
</code></pre><p>타이틀을 출력한다.</p>
<h4 id="line-40-61">Line 40 ~ 61</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">40 </span>        NEG     mm,<span class="hljs-number">2</span>            % Initialize m.
<span class="hljs-symbol">41 </span><span class="hljs-number">3</span>H      ADD     mm,mm,j0        % P10. <span class="hljs-keyword">Print</span> <span class="hljs-keyword">line</span>
<span class="hljs-symbol">42 </span>        LDA     t,Blanks        % Output <span class="hljs-string">"   "</span>.
<span class="hljs-symbol">43 </span>        TRAP    <span class="hljs-number">0</span>,Fputs,StdOut
<span class="hljs-symbol">44 </span><span class="hljs-number">2</span>H      LDWU    pk,ptop,mm      % pk &lt;- prime <span class="hljs-keyword">to</span> be printed
<span class="hljs-symbol">45 </span><span class="hljs-number">0</span>H      GREG    #<span class="hljs-number">2030303030000000</span>       % <span class="hljs-string">" 0000"</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
<span class="hljs-symbol">46 </span>        STOU    <span class="hljs-number">0</span>B,BUF          % Prepare buffer <span class="hljs-keyword">for</span> decimal conversion
<span class="hljs-symbol">47 </span>        LDA     t,BUF+<span class="hljs-number">4</span>         % t &lt;- position of units digit
<span class="hljs-symbol">48 </span><span class="hljs-number">1</span>H      DIV     pk,pk,<span class="hljs-number">10</span>        % pk &lt;- floor(pk/<span class="hljs-number">10</span>)
<span class="hljs-symbol">49 </span>        <span class="hljs-keyword">GET</span>     r,rR            % r &lt;- <span class="hljs-keyword">next</span> digit
<span class="hljs-symbol">50 </span>        INCL    r,<span class="hljs-comment">'0'           % r &lt;- ASCII digit r</span>
<span class="hljs-symbol">51 </span>        STBU    r,t,<span class="hljs-number">0</span>           % Store r in the buffer
<span class="hljs-symbol">52 </span>        SUB     t,t,<span class="hljs-number">1</span>           % Move one byte <span class="hljs-keyword">to</span> the left
<span class="hljs-symbol">53 </span>        PBNZ    pk,<span class="hljs-number">1</span>B           % Repeat <span class="hljs-keyword">on</span> <span class="hljs-comment">remaining digits</span>
<span class="hljs-symbol">54 </span>        LDA     t,BUF           % Output <span class="hljs-string">" "</span> <span class="hljs-keyword">and</span> four digits
<span class="hljs-symbol">55 </span>        TRAP    <span class="hljs-number">0</span>,Fputs,StdOut
<span class="hljs-symbol">56 </span>        INCL    mm,<span class="hljs-number">2</span>*L/<span class="hljs-number">10</span>       % Advance by <span class="hljs-number">50</span> wydes
<span class="hljs-symbol">57 </span>        PBN     mm,<span class="hljs-number">2</span>B
<span class="hljs-symbol">58 </span>        LDA     t,NewLn         % Output a newline
<span class="hljs-symbol">59 </span>        TRAP    <span class="hljs-number">0</span>,Fputs,StdOut
<span class="hljs-symbol">60 </span>        CMP     t,mm,<span class="hljs-number">2</span>*(L/<span class="hljs-number">10</span>-<span class="hljs-number">1</span>) % P11. <span class="hljs-number">500</span> printed?
<span class="hljs-symbol">61 </span>        PBNZ    t,<span class="hljs-number">3</span>B            % <span class="hljs-keyword">To</span> P10 <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> done
</code></pre><p>40번 줄에서는 mm(g#250)을 -2로 설정.</p>
<p>41번 줄에서는 mm = mm + j0로 설정</p>
<p>42번 ~ 43번 줄에서는 출력 라인의 첫 시작인 공백문자 3개를 출력한다.</p>
<p>44번 줄에서는 출력할 소수를 pk로 가져온다. pk는 PRIMES[ptop + mm].</p>
<p>45번 줄에서는 숫자를 문자열로 변환하기 위한 문자열을 위한 전역 레지스터를 할당한다.</p>
<p>46번 줄에서는 45번에 선언한 문자열을 BUF에 저장한다.</p>
<p>47번 줄에서는 t가 BUF + 4의 위치를 가리키도록 한다.</p>
<pre class="highlight"><code class="hljs excel"><span class="hljs-string">" 0000"</span>
     ^
     <span class="hljs-built_in">t</span>
</code></pre><p>48번 줄에서는 pk를 10으로 나눈 몫을 pk에 저장한다.</p>
<p>49번 줄에서는 pk의 나머지(digit)가 저장된 rR의 값을 r로 가져온다.</p>
<p>50번 줄에서는 digit를 char로 변환하기 위해 r에 문자 &#39;0&#39;을 더해준다.</p>
<p>51번 줄에서는 이렇게 변환된 digit을 버퍼에 저장한다.</p>
<p>52번 줄에서는 t에서 1을 빼서 앞의 자릿수로 이동시킨다.</p>
<pre class="highlight"><code class="hljs excel"><span class="hljs-string">" 0002"</span>
    ^
    <span class="hljs-built_in">t</span>
</code></pre><p>53번 줄에서는 pk이가 0이 아닌 경우, 출력할 자릿수가 더 남았다는 의미이므로 &quot;1 backward&quot;인 48번줄의 1H 라벨로 이동한다.</p>
<p>54~55번 줄에서는 BUF에 저장된 소수를 출력한다.</p>
<p>56번 줄에서는 다음에 출력할 소수의 위치를 계산하는데 소수 테이블이 row가 50고, column이 10이라, 현재 숫자에서 다음 50번째 숫자를 출력하기 위해 mm을 2 * L / 10 만큼 증가 시킨다.</p>
<p>57번 줄에서 mm이 음수면 현재 줄에 출력한 소수가 남았다는 의미로 &quot;2 backward&quot;인 44번줄로의 2H 라벨로 이동한다.</p>
<p>58~59번 줄은 10개의 소수를 다 출력하고 난 후, 개행문자를 출력해준다.</p>
<p>60번 줄에서는 mm이 마지막 소수를 가리키는 위치인지 검사한다.</p>
<p>61번 줄에서는 mm과 마지막 소수의 위치가를 비교한 경과가 같지 않은 경우(0이 아닌 경우), &quot;3 backward&quot;인 41번 줄의 3H 라벨로 이동한다.</p>
<p>mm의 값의 변화는 다음과 같다.</p>
<table>
<thead>
<tr>
<th style="text-align:center">Line</th>
<th style="text-align:right">c00</th>
<th style="text-align:right">c01</th>
<th style="text-align:right">c02</th>
<th style="text-align:right">c03</th>
<th style="text-align:right">c04</th>
<th style="text-align:right">c05</th>
<th style="text-align:right">c06</th>
<th style="text-align:right">c07</th>
<th style="text-align:right">c08</th>
<th style="text-align:right">c09</th>
<th style="text-align:right">-</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:right">-1000</td>
<td style="text-align:right">-900</td>
<td style="text-align:right">-800</td>
<td style="text-align:right">-700</td>
<td style="text-align:right">-600</td>
<td style="text-align:right">-500</td>
<td style="text-align:right">-400</td>
<td style="text-align:right">-300</td>
<td style="text-align:right">-200</td>
<td style="text-align:right">-100</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:right">-998</td>
<td style="text-align:right">-898</td>
<td style="text-align:right">-798</td>
<td style="text-align:right">-698</td>
<td style="text-align:right">-598</td>
<td style="text-align:right">-498</td>
<td style="text-align:right">-398</td>
<td style="text-align:right">-298</td>
<td style="text-align:right">-198</td>
<td style="text-align:right">-98</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:right">-996</td>
<td style="text-align:right">-896</td>
<td style="text-align:right">-796</td>
<td style="text-align:right">-696</td>
<td style="text-align:right">-596</td>
<td style="text-align:right">-496</td>
<td style="text-align:right">-396</td>
<td style="text-align:right">-296</td>
<td style="text-align:right">-196</td>
<td style="text-align:right">-96</td>
<td style="text-align:right">4</td>
</tr>
</tbody>
</table>
<h3 id="-">프로그램 종료</h3>
<h4 id="line-62">Line 62</h4>
<pre class="highlight"><code class="hljs basic"><span class="hljs-symbol">62 </span>        TRAP    <span class="hljs-number">0</span>,Halt,<span class="hljs-number">0</span>
</code></pre><p>프로그램을 종료한다.</p>
</article></section><section class="tags">Tags: tsg,mmix</section><footer><section><p>&copy;2018 <a href="https://soharu.github.io">soharu</a>. All rights reserved.
Powered by <a href="https://pages.github.com/">Github Page</a>.
Generated by <a href="https://docpad.org/">DocPad</a>.</p></section></footer><script defer="defer"  src="/vendor/jquery.min.js"></script><script defer="defer"  src="/scripts/script.js"></script></body></html>